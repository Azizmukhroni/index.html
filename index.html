<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AduanMasyarakat - Layanan Pengaduan Real-Time</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="AduanMasyarakat">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/180/1006/1006771.png">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/192/1006/1006771.png">
    <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/192/1006/1006771.png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">
    
    <!-- CSS Internal -->
    <style>
        /* CSS yang sama seperti sebelumnya, dipersingkat untuk fokus pada perbaikan */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            max-width: 100%;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        /* ... (CSS lainnya sama) ... */
        
        /* Tambahan untuk keamanan password */
        .password-strength {
            height: 5px;
            margin-top: 5px;
            border-radius: 3px;
            transition: all 0.3s ease;
        }
        
        .password-weak {
            background-color: #e74c3c;
            width: 33%;
        }
        
        .password-medium {
            background-color: #f39c12;
            width: 66%;
        }
        
        .password-strong {
            background-color: #2ecc71;
            width: 100%;
        }
        
        .password-strength-text {
            font-size: 12px;
            margin-top: 5px;
            text-align: right;
        }
    </style>
</head>
<body>
    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Langsung ke konten utama</a>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="toast-icon"></i>
        <span class="toast-message"></span>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- ... (HTML lainnya sama) ... -->

    <script>
        // Import library untuk hashing password (gunakan yang sesuai)
        // Catatan: Untuk produksi, gunakan backend yang aman untuk hashing password
        // Ini hanya contoh sederhana untuk frontend
        
        // Simple hashing function (not production secure)
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hash))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }

        // Password strength checker
        function checkPasswordStrength(password) {
            let strength = 0;
            
            // Length check
            if (password.length >= 8) strength++;
            if (password.length >= 12) strength++;
            
            // Character variety checks
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            return strength;
        }

        // Update password strength indicator
        function updatePasswordStrength(password) {
            const strengthBar = document.getElementById('password-strength-bar');
            const strengthText = document.getElementById('password-strength-text');
            
            if (!password) {
                strengthBar.className = 'password-strength';
                strengthBar.style.width = '0';
                strengthText.textContent = '';
                return;
            }
            
            const strength = checkPasswordStrength(password);
            
            if (strength <= 2) {
                strengthBar.className = 'password-strength password-weak';
                strengthText.textContent = 'Lemah';
                strengthText.style.color = '#e74c3c';
            } else if (strength <= 4) {
                strengthBar.className = 'password-strength password-medium';
                strengthText.textContent = 'Sedang';
                strengthText.style.color = '#f39c12';
            } else {
                strengthBar.className = 'password-strength password-strong';
                strengthText.textContent = 'Kuat';
                strengthText.style.color = '#2ecc71';
            }
        }

        // DOM Elements
        const navToggle = document.getElementById('nav-toggle');
        const navMenu = document.getElementById('nav-menu');
        const navClose = document.getElementById('nav-close');
        const navOverlay = document.getElementById('nav-overlay');
        // ... (element lainnya sama) ...

        // Event listener untuk password strength
        document.getElementById('register-password').addEventListener('input', function(e) {
            updatePasswordStrength(e.target.value);
        });

        // Register Form Submission - Diperbarui dengan hashing password
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const phone = document.getElementById('register-phone').value;
            const password = document.getElementById('register-password').value;
            const confirm = document.getElementById('register-confirm').value;
            
            // Simple validation
            if (!name || !email || !password || !confirm) {
                showToast('Harap isi semua field yang wajib', 'error');
                return;
            }
            
            if (password !== confirm) {
                showToast('Konfirmasi password tidak cocok', 'error');
                return;
            }
            
            // Check password strength
            if (checkPasswordStrength(password) < 3) {
                showToast('Password terlalu lemah. Gunakan kombinasi huruf, angka, dan karakter khusus', 'error');
                return;
            }
            
            // Check if user already exists
            const users = JSON.parse(localStorage.getItem('users')) || [];
            if (users.some(user => user.email === email)) {
                showToast('Email sudah terdaftar', 'error');
                return;
            }
            
            try {
                // Hash password sebelum disimpan
                const hashedPassword = await hashPassword(password);
                
                // Create new user
                const newUser = {
                    id: Date.now(),
                    name,
                    email,
                    phone,
                    password: hashedPassword, // Simpan password yang sudah di-hash
                    createdAt: new Date().toISOString()
                };
                
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                
                // Auto login after registration
                localStorage.setItem('currentUser', JSON.stringify(newUser));
                localStorage.setItem('isLoggedIn', 'true');
                
                showToast('Pendaftaran berhasil! Anda telah masuk.', 'success');
                closeAuthModal();
                checkAuthStatus();
                
                // Clear form
                registerForm.reset();
                document.getElementById('password-strength-bar').className = 'password-strength';
                document.getElementById('password-strength-text').textContent = '';
            } catch (error) {
                showToast('Terjadi kesalahan saat mendaftar', 'error');
                console.error('Registration error:', error);
            }
        });

        // Login Form Submission - Diperbarui dengan membandingkan hash
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            // Simple validation
            if (!email || !password) {
                showToast('Harap isi semua field', 'error');
                return;
            }
            
            try {
                // Hash password input
                const hashedPassword = await hashPassword(password);
                
                // Check if user exists
                const users = JSON.parse(localStorage.getItem('users')) || [];
                const user = users.find(u => u.email === email && u.password === hashedPassword);
                
                if (user) {
                    // Login successful
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    localStorage.setItem('isLoggedIn', 'true');
                    
                    showToast('Login berhasil!', 'success');
                    closeAuthModal();
                    checkAuthStatus();
                    
                    // Clear form
                    loginForm.reset();
                } else {
                    showToast('Email atau password salah', 'error');
                }
            } catch (error) {
                showToast('Terjadi kesalahan saat login', 'error');
                console.error('Login error:', error);
            }
        });

        // ... (kode JavaScript lainnya) ...
    </script>
</body>
</html>